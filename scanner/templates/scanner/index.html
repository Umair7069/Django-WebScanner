<!DOCTYPE html>
<html>
<head>
    <title>Web Scanner</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
</head>
<body class="d-flex flex-column min-vh-100">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">WebScanner</a>
        </div>
    </nav>

    <main class="container my-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow-sm">
                    {% extends 'base.html' %}

                    {% block title %}Start Scan â€” WebScanner{% endblock %}

                    {% block content %}
                    <div class="row justify-content-center">
                        <div class="col-lg-8 col-md-10">
                            <div class="card shadow-sm">
                                <div class="card-body">
                                    <h3 class="card-title text-primary mb-2">Start a Scan</h3>
                                    <p class="small-muted mb-3">Enter the target and pick tests to run.</p>

                                    <form method="POST" id="scan-form">
                                        {% csrf_token %}
                                        <div class="mb-3">
                                            <label class="form-label">Target URL</label>
                                            <input type="url" name="url" class="form-control form-control-lg" placeholder="https://example.com/page?param=1" required>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label">Select tests to run</label>
                                            <div class="d-flex gap-3 flex-wrap">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="on" id="test_xss" name="test_xss" checked>
                                                    <label class="form-check-label" for="test_xss">Reflected XSS</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="on" id="test_sqli" name="test_sqli" checked>
                                                    <label class="form-check-label" for="test_sqli">SQL Injection</label>
                                                </div>
                                            </div>
                                            <div class="mt-2"><small class="text-muted">Only scan targets you have permission to test.</small></div>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label">Authentication (cookie)</label>
                                            <div class="mt-1">
                                                <textarea id="cookie" name="cookie" class="form-control" rows="3" placeholder="Paste cookie header: key1=val1; key2=val2"></textarea>
                                                <small class="text-muted">Provide a cookie header string for authenticated scans (scanner uses cookie-only authentication).</small>
                                            </div>
                                        </div>

                                        <div class="d-flex gap-2">
                                            <button type="submit" class="btn btn-success btn-lg" id="start-scan">Start Scan</button>
                                            <a class="btn btn-outline-secondary btn-lg" href="/admin/">Admin</a>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Spinner overlay shown while form submits -->
                    <div id="scan-spinner" class="scan-spinner-overlay" style="display:none;">
                        <div class="scan-spinner-box">
                            <div class="spinner-border text-primary" role="status" style="width:3rem;height:3rem;"></div>
                            <div class="mt-3">Scanning... this can take some time</div>
                        </div>
                    </div>

                    {% block extra_js %}
                    <script>
                    document.getElementById('scan-form').addEventListener('submit', function(e){
                        document.getElementById('start-scan').disabled = true;
                        document.getElementById('scan-spinner').style.display = 'flex';
                    });
                    </script>
                    {% endblock %}

                    {% endblock %}
